<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>英語でおしゃべりゲーム</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0,-30px,0);
            }
            70% {
                transform: translate3d(0,-15px,0);
            }
            90% {
                transform: translate3d(0,-4px,0);
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ゲーム状態管理
        let gameState = {
            currentScene: 'menu',
            score: 0,
            currentQuestion: 0,
            selectedCategory: null,
            isListening: false,
            feedback: '',
            showAnswer: false
        };

        // カテゴリーデータ
        const categories = {
            animals: {
                name: '動物たち',
                emoji: '🐾',
                color: 'bg-green-400',
                questions: [
                    {
                        question: "What sound does a cat make?",
                        japanese: "猫はどんな鳴き声？",
                        answer: "meow",
                        alternatives: ["mew", "meow meow"],
                        image: "🐱"
                    },
                    {
                        question: "What sound does a dog make?",
                        japanese: "犬はどんな鳴き声？",
                        answer: "woof",
                        alternatives: ["bow wow", "woof woof", "bark"],
                        image: "🐶"
                    },
                    {
                        question: "What color is an elephant?",
                        japanese: "象は何色？",
                        answer: "gray",
                        alternatives: ["grey"],
                        image: "🐘"
                    },
                    {
                        question: "Where do birds live?",
                        japanese: "鳥はどこに住んでいる？",
                        answer: "tree",
                        alternatives: ["trees", "nest", "sky"],
                        image: "🐦"
                    }
                ]
            },
            food: {
                name: '食べもの',
                emoji: '🍎',
                color: 'bg-red-400',
                questions: [
                    {
                        question: "What color is an apple?",
                        japanese: "りんごは何色？",
                        answer: "red",
                        alternatives: ["green", "yellow"],
                        image: "🍎"
                    },
                    {
                        question: "What do you drink when you're thirsty?",
                        japanese: "のどが渇いたら何を飲む？",
                        answer: "water",
                        alternatives: ["juice", "milk"],
                        image: "💧"
                    },
                    {
                        question: "What do bees make?",
                        japanese: "ハチは何を作る？",
                        answer: "honey",
                        alternatives: [],
                        image: "🍯"
                    },
                    {
                        question: "What's yellow and long?",
                        japanese: "黄色くて長いものは？",
                        answer: "banana",
                        alternatives: [],
                        image: "🍌"
                    }
                ]
            },
            colors: {
                name: '色',
                emoji: '🌈',
                color: 'bg-purple-400',
                questions: [
                    {
                        question: "What color is the sun?",
                        japanese: "太陽は何色？",
                        answer: "yellow",
                        alternatives: ["orange"],
                        image: "☀️"
                    },
                    {
                        question: "What color is grass?",
                        japanese: "草は何色？",
                        answer: "green",
                        alternatives: [],
                        image: "🌱"
                    },
                    {
                        question: "What color is the sky?",
                        japanese: "空は何色？",
                        answer: "blue",
                        alternatives: [],
                        image: "☁️"
                    },
                    {
                        question: "What color is snow?",
                        japanese: "雪は何色？",
                        answer: "white",
                        alternatives: [],
                        image: "❄️"
                    }
                ]
            }
        };

        // 音声関連関数
        function playSound(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function startListening() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                updateState({
                    feedback: 'ごめんね！このブラウザは音声認識に対応していないよ。でも答えを見ることはできるよ！'
                });
                render();
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;

            updateState({
                isListening: true,
                feedback: '英語で答えてね！聞いているよ...'
            });
            render();

            recognition.onresult = (event) => {
                const userAnswer = event.results[0][0].transcript.toLowerCase().trim();
                checkAnswer(userAnswer);
            };

            recognition.onerror = () => {
                updateState({
                    isListening: false,
                    feedback: 'うまく聞こえなかったよ。もう一度試してみて！'
                });
                render();
            };

            recognition.onend = () => {
                updateState({ isListening: false });
                render();
            };

            recognition.start();
        }

        function checkAnswer(userAnswer) {
            const currentQ = categories[gameState.selectedCategory].questions[gameState.currentQuestion];
            const correctAnswers = [currentQ.answer, ...currentQ.alternatives];
            
            const isCorrect = correctAnswers.some(answer => 
                userAnswer.includes(answer.toLowerCase()) || answer.toLowerCase().includes(userAnswer)
            );

            if (isCorrect) {
                updateState({
                    score: gameState.score + 10,
                    feedback: `すごい！正解だよ！ "${userAnswer}" って言えたね！⭐`
                });
                playSound("Great job!");
                render();
                setTimeout(() => {
                    nextQuestion();
                }, 2000);
            } else {
                updateState({
                    feedback: `惜しい！もう一度挑戦してみよう。正解は "${currentQ.answer}" だよ。`
                });
                playSound(currentQ.answer);
                render();
            }
        }

        function nextQuestion() {
            if (gameState.currentQuestion < categories[gameState.selectedCategory].questions.length - 1) {
                updateState({
                    currentQuestion: gameState.currentQuestion + 1,
                    feedback: '',
                    showAnswer: false
                });
            } else {
                updateState({ currentScene: 'result' });
            }
            render();
        }

        function resetGame() {
            updateState({
                currentScene: 'menu',
                score: 0,
                currentQuestion: 0,
                selectedCategory: null,
                feedback: '',
                showAnswer: false
            });
            render();
        }

        function selectCategory(category) {
            updateState({
                selectedCategory: category,
                currentScene: 'game',
                currentQuestion: 0,
                score: 0,
                feedback: '',
                showAnswer: false
            });
            render();
        }

        function updateState(newState) {
            gameState = { ...gameState, ...newState };
        }

        // レンダリング関数
        function renderMenu() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 p-4">
                    <div class="max-w-4xl mx-auto">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-bold text-white mb-4 animate-bounce">
                                🎤 英語でおしゃべりゲーム 🎤
                            </h1>
                            <p class="text-xl text-white">
                                英語で答えて、スターを集めよう！
                            </p>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            ${Object.entries(categories).map(([key, category]) => `
                                <button
                                    onclick="selectCategory('${key}')"
                                    class="${category.color} hover:scale-105 transform transition-all duration-200 rounded-xl p-6 text-white font-bold text-xl shadow-lg hover:shadow-xl"
                                >
                                    <div class="text-4xl mb-4">${category.emoji}</div>
                                    <div>${category.name}</div>
                                    <div class="text-sm mt-2 opacity-90">
                                        ${category.questions.length}問
                                    </div>
                                </button>
                            `).join('')}
                        </div>

                        <div class="text-center mt-8 text-white">
                            <p class="text-lg mb-2">🎯 遊び方</p>
                            <p class="text-sm opacity-90">
                                カテゴリーを選んで、英語で質問に答えよう！<br/>
                                マイクボタンを押して話すか、答えを見ることもできるよ。
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGame() {
            const currentQ = categories[gameState.selectedCategory].questions[gameState.currentQuestion];
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 p-4">
                    <div class="max-w-2xl mx-auto">
                        <!-- ヘッダー -->
                        <div class="flex justify-between items-center mb-6">
                            <button
                                onclick="resetGame()"
                                class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg flex items-center gap-2"
                            >
                                ↩️ メニューに戻る
                            </button>
                            <div class="flex items-center gap-4 text-white">
                                <div class="flex items-center gap-1">
                                    <span class="text-yellow-300">⭐</span>
                                    <span class="font-bold">${gameState.score}</span>
                                </div>
                                <div class="text-sm">
                                    ${gameState.currentQuestion + 1} / ${categories[gameState.selectedCategory].questions.length}
                                </div>
                            </div>
                        </div>

                        <!-- 質問カード -->
                        <div class="bg-white rounded-xl p-8 shadow-xl mb-6">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">${currentQ.image}</div>
                                <h2 class="text-2xl font-bold text-gray-800 mb-2">
                                    ${currentQ.question}
                                </h2>
                                <p class="text-gray-600">
                                    ${currentQ.japanese}
                                </p>
                            </div>

                            <!-- 音声読み上げボタン -->
                            <div class="text-center mb-6">
                                <button
                                    onclick="playSound('${currentQ.question.replace(/'/g, "\\'")}')"
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 mx-auto"
                                >
                                    🔊 質問を聞く
                                </button>
                            </div>

                            <!-- 回答ボタン -->
                            <div class="flex justify-center gap-4 mb-6">
                                <button
                                    onclick="startListening()"
                                    ${gameState.isListening ? 'disabled' : ''}
                                    class="${gameState.isListening ? 'bg-red-500' : 'bg-green-500 hover:bg-green-600'} text-white px-6 py-3 rounded-lg flex items-center gap-2 font-bold"
                                >
                                    🎤 ${gameState.isListening ? '聞いているよ...' : '英語で答える'}
                                </button>
                                
                                <button
                                    onclick="updateState({showAnswer: !gameState.showAnswer}); render();"
                                    class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg"
                                >
                                    ${gameState.showAnswer ? '答えを隠す' : '答えを見る'}
                                </button>
                            </div>

                            <!-- 答え表示 -->
                            ${gameState.showAnswer ? `
                                <div class="text-center bg-yellow-100 p-4 rounded-lg mb-4">
                                    <p class="text-lg font-bold text-gray-800">
                                        答え: <span class="text-blue-600">${currentQ.answer}</span>
                                    </p>
                                    ${currentQ.alternatives.length > 0 ? `
                                        <p class="text-sm text-gray-600 mt-2">
                                            他の答え: ${currentQ.alternatives.join(', ')}
                                        </p>
                                    ` : ''}
                                    <button
                                        onclick="playSound('${currentQ.answer.replace(/'/g, "\\'")}')"
                                        class="mt-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm flex items-center gap-1 mx-auto"
                                    >
                                        🔊 発音を聞く
                                    </button>
                                </div>
                            ` : ''}

                            <!-- フィードバック -->
                            ${gameState.feedback ? `
                                <div class="text-center bg-blue-100 p-4 rounded-lg mb-4">
                                    <p class="text-gray-800">${gameState.feedback}</p>
                                </div>
                            ` : ''}

                            <!-- 次の問題ボタン -->
                            ${gameState.showAnswer ? `
                                <div class="text-center">
                                    <button
                                        onclick="nextQuestion()"
                                        class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-bold"
                                    >
                                        次の問題へ →
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderResult() {
            const totalQuestions = categories[gameState.selectedCategory].questions.length;
            const maxScore = totalQuestions * 10;
            const percentage = (gameState.score / maxScore) * 100;
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 p-4 flex items-center justify-center">
                    <div class="bg-white rounded-xl p-8 shadow-xl text-center max-w-md">
                        <div class="text-yellow-500 text-6xl mb-4">🏆</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">
                            おつかれさま！
                        </h2>
                        <div class="text-6xl mb-4">
                            ${percentage >= 80 ? '🏆' : percentage >= 60 ? '🥈' : '🏅'}
                        </div>
                        <p class="text-xl text-gray-700 mb-4">
                            スコア: <span class="font-bold text-blue-600">${gameState.score}</span> / ${maxScore}
                        </p>
                        <p class="text-gray-600 mb-6">
                            ${percentage >= 80 ? 'すばらしい！' : 
                              percentage >= 60 ? 'よくできました！' : 
                              'がんばったね！もう一度挑戦してみよう！'}
                        </p>
                        <div class="flex gap-4 justify-center">
                            <button
                                onclick="updateState({currentQuestion: 0, score: 0, currentScene: 'game', feedback: '', showAnswer: false}); render();"
                                class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg"
                            >
                                もう一度
                            </button>
                            <button
                                onclick="resetGame()"
                                class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg"
                            >
                                メニューに戻る
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (gameState.currentScene === 'menu') {
                app.innerHTML = renderMenu();
            } else if (gameState.currentScene === 'game') {
                app.innerHTML = renderGame();
            } else if (gameState.currentScene === 'result') {
                app.innerHTML = renderResult();
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            render();
        });
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', render);
        } else {
            render();
        }
    </script>
</body>
</html>
