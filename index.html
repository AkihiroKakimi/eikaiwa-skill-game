<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±èªã§ãŠã—ã‚ƒã¹ã‚Šã‚²ãƒ¼ãƒ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% {
                transform: translate3d(0,0,0);
            }
            40%, 43% {
                transform: translate3d(0,-30px,0);
            }
            70% {
                transform: translate3d(0,-15px,0);
            }
            90% {
                transform: translate3d(0,-4px,0);
            }
        }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ç®¡ç†
        let gameState = {
            currentScene: 'menu',
            score: 0,
            currentQuestion: 0,
            selectedCategory: null,
            isListening: false,
            feedback: '',
            showAnswer: false
        };

        // ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿
        const categories = {
            animals: {
                name: 'å‹•ç‰©ãŸã¡',
                emoji: 'ğŸ¾',
                color: 'bg-green-400',
                questions: [
                    {
                        question: "What sound does a cat make?",
                        japanese: "çŒ«ã¯ã©ã‚“ãªé³´ãå£°ï¼Ÿ",
                        answer: "meow",
                        alternatives: ["mew", "meow meow"],
                        image: "ğŸ±"
                    },
                    {
                        question: "What sound does a dog make?",
                        japanese: "çŠ¬ã¯ã©ã‚“ãªé³´ãå£°ï¼Ÿ",
                        answer: "woof",
                        alternatives: ["bow wow", "woof woof", "bark"],
                        image: "ğŸ¶"
                    },
                    {
                        question: "What color is an elephant?",
                        japanese: "è±¡ã¯ä½•è‰²ï¼Ÿ",
                        answer: "gray",
                        alternatives: ["grey"],
                        image: "ğŸ˜"
                    },
                    {
                        question: "Where do birds live?",
                        japanese: "é³¥ã¯ã©ã“ã«ä½ã‚“ã§ã„ã‚‹ï¼Ÿ",
                        answer: "tree",
                        alternatives: ["trees", "nest", "sky"],
                        image: "ğŸ¦"
                    }
                ]
            },
            food: {
                name: 'é£Ÿã¹ã‚‚ã®',
                emoji: 'ğŸ',
                color: 'bg-red-400',
                questions: [
                    {
                        question: "What color is an apple?",
                        japanese: "ã‚Šã‚“ã”ã¯ä½•è‰²ï¼Ÿ",
                        answer: "red",
                        alternatives: ["green", "yellow"],
                        image: "ğŸ"
                    },
                    {
                        question: "What do you drink when you're thirsty?",
                        japanese: "ã®ã©ãŒæ¸‡ã„ãŸã‚‰ä½•ã‚’é£²ã‚€ï¼Ÿ",
                        answer: "water",
                        alternatives: ["juice", "milk"],
                        image: "ğŸ’§"
                    },
                    {
                        question: "What do bees make?",
                        japanese: "ãƒãƒã¯ä½•ã‚’ä½œã‚‹ï¼Ÿ",
                        answer: "honey",
                        alternatives: [],
                        image: "ğŸ¯"
                    },
                    {
                        question: "What's yellow and long?",
                        japanese: "é»„è‰²ãã¦é•·ã„ã‚‚ã®ã¯ï¼Ÿ",
                        answer: "banana",
                        alternatives: [],
                        image: "ğŸŒ"
                    }
                ]
            },
            colors: {
                name: 'è‰²',
                emoji: 'ğŸŒˆ',
                color: 'bg-purple-400',
                questions: [
                    {
                        question: "What color is the sun?",
                        japanese: "å¤ªé™½ã¯ä½•è‰²ï¼Ÿ",
                        answer: "yellow",
                        alternatives: ["orange"],
                        image: "â˜€ï¸"
                    },
                    {
                        question: "What color is grass?",
                        japanese: "è‰ã¯ä½•è‰²ï¼Ÿ",
                        answer: "green",
                        alternatives: [],
                        image: "ğŸŒ±"
                    },
                    {
                        question: "What color is the sky?",
                        japanese: "ç©ºã¯ä½•è‰²ï¼Ÿ",
                        answer: "blue",
                        alternatives: [],
                        image: "â˜ï¸"
                    },
                    {
                        question: "What color is snow?",
                        japanese: "é›ªã¯ä½•è‰²ï¼Ÿ",
                        answer: "white",
                        alternatives: [],
                        image: "â„ï¸"
                    }
                ]
            }
        };

        // éŸ³å£°é–¢é€£é–¢æ•°
        function playSound(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function startListening() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                updateState({
                    feedback: 'ã”ã‚ã‚“ã­ï¼ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ãªã„ã‚ˆã€‚ã§ã‚‚ç­”ãˆã‚’è¦‹ã‚‹ã“ã¨ã¯ã§ãã‚‹ã‚ˆï¼'
                });
                render();
                return;
            }

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            
            recognition.lang = 'en-US';
            recognition.continuous = false;
            recognition.interimResults = false;

            updateState({
                isListening: true,
                feedback: 'è‹±èªã§ç­”ãˆã¦ã­ï¼èã„ã¦ã„ã‚‹ã‚ˆ...'
            });
            render();

            recognition.onresult = (event) => {
                const userAnswer = event.results[0][0].transcript.toLowerCase().trim();
                checkAnswer(userAnswer);
            };

            recognition.onerror = () => {
                updateState({
                    isListening: false,
                    feedback: 'ã†ã¾ãèã“ãˆãªã‹ã£ãŸã‚ˆã€‚ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ã¿ã¦ï¼'
                });
                render();
            };

            recognition.onend = () => {
                updateState({ isListening: false });
                render();
            };

            recognition.start();
        }

        function checkAnswer(userAnswer) {
            const currentQ = categories[gameState.selectedCategory].questions[gameState.currentQuestion];
            const correctAnswers = [currentQ.answer, ...currentQ.alternatives];
            
            const isCorrect = correctAnswers.some(answer => 
                userAnswer.includes(answer.toLowerCase()) || answer.toLowerCase().includes(userAnswer)
            );

            if (isCorrect) {
                updateState({
                    score: gameState.score + 10,
                    feedback: `ã™ã”ã„ï¼æ­£è§£ã ã‚ˆï¼ "${userAnswer}" ã£ã¦è¨€ãˆãŸã­ï¼â­`
                });
                playSound("Great job!");
                render();
                setTimeout(() => {
                    nextQuestion();
                }, 2000);
            } else {
                updateState({
                    feedback: `æƒœã—ã„ï¼ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¦ã¿ã‚ˆã†ã€‚æ­£è§£ã¯ "${currentQ.answer}" ã ã‚ˆã€‚`
                });
                playSound(currentQ.answer);
                render();
            }
        }

        function nextQuestion() {
            if (gameState.currentQuestion < categories[gameState.selectedCategory].questions.length - 1) {
                updateState({
                    currentQuestion: gameState.currentQuestion + 1,
                    feedback: '',
                    showAnswer: false
                });
            } else {
                updateState({ currentScene: 'result' });
            }
            render();
        }

        function resetGame() {
            updateState({
                currentScene: 'menu',
                score: 0,
                currentQuestion: 0,
                selectedCategory: null,
                feedback: '',
                showAnswer: false
            });
            render();
        }

        function selectCategory(category) {
            updateState({
                selectedCategory: category,
                currentScene: 'game',
                currentQuestion: 0,
                score: 0,
                feedback: '',
                showAnswer: false
            });
            render();
        }

        function updateState(newState) {
            gameState = { ...gameState, ...newState };
        }

        // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
        function renderMenu() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 p-4">
                    <div class="max-w-4xl mx-auto">
                        <div class="text-center mb-8">
                            <h1 class="text-4xl font-bold text-white mb-4 animate-bounce">
                                ğŸ¤ è‹±èªã§ãŠã—ã‚ƒã¹ã‚Šã‚²ãƒ¼ãƒ  ğŸ¤
                            </h1>
                            <p class="text-xl text-white">
                                è‹±èªã§ç­”ãˆã¦ã€ã‚¹ã‚¿ãƒ¼ã‚’é›†ã‚ã‚ˆã†ï¼
                            </p>
                        </div>
                        
                        <div class="grid md:grid-cols-3 gap-6">
                            ${Object.entries(categories).map(([key, category]) => `
                                <button
                                    onclick="selectCategory('${key}')"
                                    class="${category.color} hover:scale-105 transform transition-all duration-200 rounded-xl p-6 text-white font-bold text-xl shadow-lg hover:shadow-xl"
                                >
                                    <div class="text-4xl mb-4">${category.emoji}</div>
                                    <div>${category.name}</div>
                                    <div class="text-sm mt-2 opacity-90">
                                        ${category.questions.length}å•
                                    </div>
                                </button>
                            `).join('')}
                        </div>

                        <div class="text-center mt-8 text-white">
                            <p class="text-lg mb-2">ğŸ¯ éŠã³æ–¹</p>
                            <p class="text-sm opacity-90">
                                ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’é¸ã‚“ã§ã€è‹±èªã§è³ªå•ã«ç­”ãˆã‚ˆã†ï¼<br/>
                                ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è©±ã™ã‹ã€ç­”ãˆã‚’è¦‹ã‚‹ã“ã¨ã‚‚ã§ãã‚‹ã‚ˆã€‚
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderGame() {
            const currentQ = categories[gameState.selectedCategory].questions[gameState.currentQuestion];
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 p-4">
                    <div class="max-w-2xl mx-auto">
                        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
                        <div class="flex justify-between items-center mb-6">
                            <button
                                onclick="resetGame()"
                                class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg flex items-center gap-2"
                            >
                                â†©ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
                            </button>
                            <div class="flex items-center gap-4 text-white">
                                <div class="flex items-center gap-1">
                                    <span class="text-yellow-300">â­</span>
                                    <span class="font-bold">${gameState.score}</span>
                                </div>
                                <div class="text-sm">
                                    ${gameState.currentQuestion + 1} / ${categories[gameState.selectedCategory].questions.length}
                                </div>
                            </div>
                        </div>

                        <!-- è³ªå•ã‚«ãƒ¼ãƒ‰ -->
                        <div class="bg-white rounded-xl p-8 shadow-xl mb-6">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">${currentQ.image}</div>
                                <h2 class="text-2xl font-bold text-gray-800 mb-2">
                                    ${currentQ.question}
                                </h2>
                                <p class="text-gray-600">
                                    ${currentQ.japanese}
                                </p>
                            </div>

                            <!-- éŸ³å£°èª­ã¿ä¸Šã’ãƒœã‚¿ãƒ³ -->
                            <div class="text-center mb-6">
                                <button
                                    onclick="playSound('${currentQ.question.replace(/'/g, "\\'")}')"
                                    class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg flex items-center gap-2 mx-auto"
                                >
                                    ğŸ”Š è³ªå•ã‚’èã
                                </button>
                            </div>

                            <!-- å›ç­”ãƒœã‚¿ãƒ³ -->
                            <div class="flex justify-center gap-4 mb-6">
                                <button
                                    onclick="startListening()"
                                    ${gameState.isListening ? 'disabled' : ''}
                                    class="${gameState.isListening ? 'bg-red-500' : 'bg-green-500 hover:bg-green-600'} text-white px-6 py-3 rounded-lg flex items-center gap-2 font-bold"
                                >
                                    ğŸ¤ ${gameState.isListening ? 'èã„ã¦ã„ã‚‹ã‚ˆ...' : 'è‹±èªã§ç­”ãˆã‚‹'}
                                </button>
                                
                                <button
                                    onclick="updateState({showAnswer: !gameState.showAnswer}); render();"
                                    class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg"
                                >
                                    ${gameState.showAnswer ? 'ç­”ãˆã‚’éš ã™' : 'ç­”ãˆã‚’è¦‹ã‚‹'}
                                </button>
                            </div>

                            <!-- ç­”ãˆè¡¨ç¤º -->
                            ${gameState.showAnswer ? `
                                <div class="text-center bg-yellow-100 p-4 rounded-lg mb-4">
                                    <p class="text-lg font-bold text-gray-800">
                                        ç­”ãˆ: <span class="text-blue-600">${currentQ.answer}</span>
                                    </p>
                                    ${currentQ.alternatives.length > 0 ? `
                                        <p class="text-sm text-gray-600 mt-2">
                                            ä»–ã®ç­”ãˆ: ${currentQ.alternatives.join(', ')}
                                        </p>
                                    ` : ''}
                                    <button
                                        onclick="playSound('${currentQ.answer.replace(/'/g, "\\'")}')"
                                        class="mt-2 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm flex items-center gap-1 mx-auto"
                                    >
                                        ğŸ”Š ç™ºéŸ³ã‚’èã
                                    </button>
                                </div>
                            ` : ''}

                            <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ -->
                            ${gameState.feedback ? `
                                <div class="text-center bg-blue-100 p-4 rounded-lg mb-4">
                                    <p class="text-gray-800">${gameState.feedback}</p>
                                </div>
                            ` : ''}

                            <!-- æ¬¡ã®å•é¡Œãƒœã‚¿ãƒ³ -->
                            ${gameState.showAnswer ? `
                                <div class="text-center">
                                    <button
                                        onclick="nextQuestion()"
                                        class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-bold"
                                    >
                                        æ¬¡ã®å•é¡Œã¸ â†’
                                    </button>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderResult() {
            const totalQuestions = categories[gameState.selectedCategory].questions.length;
            const maxScore = totalQuestions * 10;
            const percentage = (gameState.score / maxScore) * 100;
            
            return `
                <div class="min-h-screen bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 p-4 flex items-center justify-center">
                    <div class="bg-white rounded-xl p-8 shadow-xl text-center max-w-md">
                        <div class="text-yellow-500 text-6xl mb-4">ğŸ†</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">
                            ãŠã¤ã‹ã‚Œã•ã¾ï¼
                        </h2>
                        <div class="text-6xl mb-4">
                            ${percentage >= 80 ? 'ğŸ†' : percentage >= 60 ? 'ğŸ¥ˆ' : 'ğŸ…'}
                        </div>
                        <p class="text-xl text-gray-700 mb-4">
                            ã‚¹ã‚³ã‚¢: <span class="font-bold text-blue-600">${gameState.score}</span> / ${maxScore}
                        </p>
                        <p class="text-gray-600 mb-6">
                            ${percentage >= 80 ? 'ã™ã°ã‚‰ã—ã„ï¼' : 
                              percentage >= 60 ? 'ã‚ˆãã§ãã¾ã—ãŸï¼' : 
                              'ãŒã‚“ã°ã£ãŸã­ï¼ã‚‚ã†ä¸€åº¦æŒ‘æˆ¦ã—ã¦ã¿ã‚ˆã†ï¼'}
                        </p>
                        <div class="flex gap-4 justify-center">
                            <button
                                onclick="updateState({currentQuestion: 0, score: 0, currentScene: 'game', feedback: '', showAnswer: false}); render();"
                                class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg"
                            >
                                ã‚‚ã†ä¸€åº¦
                            </button>
                            <button
                                onclick="resetGame()"
                                class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg"
                            >
                                ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«æˆ»ã‚‹
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function render() {
            const app = document.getElementById('app');
            
            if (gameState.currentScene === 'menu') {
                app.innerHTML = renderMenu();
            } else if (gameState.currentScene === 'game') {
                app.innerHTML = renderGame();
            } else if (gameState.currentScene === 'result') {
                app.innerHTML = renderResult();
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            render();
        });
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', render);
        } else {
            render();
        }
    </script>
</body>
</html>
